# 初始化，建立数据库
> 以共享单车为框架

```sql
drop DATABASE  if EXISTS  practiseOne; 
CREATE DATABASE practiseOne;
use practiseOne;

CREATE TABLE IF NOT EXISTS OriginDestination (
  id              INT  AUTO_INCREMENT NOT NULL, /*不为空值 唯一性约束*/ 
  number          VARCHAR(255),
  pickuptime      TIME,
  pickuplocationN DECIMAL(10, 7),
  pickuplocationE DECIMAL(10, 7),
  parkuptime      TIME,
  parkuplocationN DECIMAL(10, 7),
  parkuplocationE DECIMAL(10, 7),
  useduration     TIME DEFAULT NULL,
  PRIMARY KEY(id,number)
);

CREATE TABLE IF NOT EXISTS park (
  id              INT  AUTO_INCREMENT ,
  number          VARCHAR(255) DEFAULT 0,
  parkuptime      TIME,
  parkuplocationN DECIMAL(10, 7),
  parkuplocationE DECIMAL(10, 7),
  pickuptime      TIME,
  parkduration    TIME DEFAULT NULL,
  CONSTRAINT fk FOREIGN key(id,number) /*外键约束*/
  REFERENCES OriginDestination(id,number)
);

```
# 创建触发器
> 在插入、更新前进行检查，自动更新时间
```sql
CREATE TRIGGER insert_od
BEFORE INSERT
  ON OriginDestination
FOR EACH ROW
  SET NEW.useduration = timediff(NEW.parkuptime, NEW.pickuptime);

CREATE TRIGGER update_od
BEFORE UPDATE
  ON OriginDestination
FOR EACH ROW
  SET NEW.useduration = timediff(NEW.parkuptime , NEW.pickuptime)


CREATE TRIGGER insert_park
BEFORE INSERT
  ON park
FOR EACH ROW
  SET NEW.parkduration = timediff(NEW.pickuptime , NEW.parkuptime);

CREATE TRIGGER update_park
BEFORE UPDATE
  ON park
FOR EACH ROW
  SET NEW.parkduration = timediff(NEW.pickuptime , NEW.parkuptime);
```
> 在删除时，进行
delimiter //    
create trigger tri_dele345 5te before delete on OriginDestination  
for each row  
begin  
     delete from park where id = old.id;  
end // 

# 插入数据
```sql
INSERT INTO OriginDestination VALUE (NULL, '101', '01:00', 22.02, 30.01, '02:00', 23.01, 24.02, NULL);
INSERT INTO OriginDestination VALUE (NULL, '102', '02:01', 22.03, 32.01, '02:30', 23.01, 24.02, NULL);
INSERT INTO OriginDestination VALUE (NULL, '103', '03:02', 22.04, 34.01, '07:00', 23.01, 24.02, NULL);
INSERT INTO OriginDestination VALUE (NULL, '104', '03:03', 22.05, 35.01, '06:00', 23.01, 24.02, NULL);
INSERT INTO OriginDestination VALUE (NULL, '105', '04:04', 22.06, 37.01, '06:00', 23.01, 24.02, NULL);
INSERT INTO OriginDestination VALUE (NULL, '105', '05:05', 22.07, 35.01, '06:00', 23.01, 24.02, NULL);
INSERT INTO OriginDestination VALUE (NULL, '106', '01:06', 22.08, 38.01, '07:00', 23.01, 24.02, NULL);
INSERT INTO OriginDestination VALUE (NULL, '107', '01:07', 22.081, 39.01, '08:00', 23.01, 24.02, NULL);
INSERT INTO OriginDestination VALUE (NULL, '108', '01:08', 22.013, 32.01, '03:20', 23.01, 24.02, NULL);
```

# 测试外键约束
```sql
INSERT INTO park VALUE (NULL ,200,'3:00','23.03223','38.0323','05:00',NULL );

```
## 结果报错:

  Cannot add or update a child row: a foreign key constraint fails (`practiseone`.`park`, CONSTRAINT `fk` FOREIGN KEY (`id`, `number`) REFERENCES `origindestination` (`id`, `number`))

# 向park插入数据

```sql
INSERT INTO park VALUE (1 ,101,'3:00','25.03223','32.0323','05:00',NULL );
```
## 结果成功

  Query OK, 1 row affected (0.00 sec)